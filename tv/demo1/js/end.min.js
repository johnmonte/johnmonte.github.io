var urlParams = new URLSearchParams(window.location.search);
var playlistId = urlParams.get('id') || 'PLRnip88NI5MIIMzRuiAXYU185IdTEtz6o';
/*
PLBBJAlV7wxvWkO5tIxddUfAIGH0B3PYEr - Cartoons
PLLSrrkNqnVSx408sH2gT1dp-y5ouBPzMp - Filipino
PLRnip88NI5MIIMzRuiAXYU185IdTEtz6o - English
*/
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";

var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var player,
    time_update_interval = 0,
    progress_timer = 0;

function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        playerVars: {
            'autoplay': 1,
            'controls': 0,
            'cc_load_policy': 1,
            'iv_load_policy': 3,
            'rel': 0,
            'mute': 1,
            'showinfo': 0,
            'playsinline': 0
        },
        events: {
            'onReady': onPlayerReady,
            'onError': onPlayerError,
            'onStateChange': onPlayerStateChange
        }
    });
}

var playlistArray;
var playListArrayLength;
var maxNumber;
var oldNumber = 0;
var NewNumber = 0;

var unmute = document.getElementById('unmute-btn');
var playback = document.getElementById("playback-animation");

function newRandomNumber() {
    oldNumber = NewNumber;
    NewNumber = Math.floor(Math.random() * maxNumber);
    if (NewNumber == oldNumber) {
        newRandomNumber();
    } else {
        return NewNumber;
    }
}

function onPlayerReady(event) {
    player.loadPlaylist({
        'listType': 'playlist',
        'list': playlistId
    });
}

function onPlayerError(event) {
    location.reload();
}

function playLoader() {
    setTimeout(function () {
        var loader = document.getElementById("preloading");
        if (!loader.classList.contains("preloaded")) {
            loader.classList.add("preloaded");
        }
    }, 2000);
}

var firstLoad = true;
function onPlayerStateChange(event) {
    playLoader();
    updateTimerDisplay();
    updateProgressBar();
    clearInterval(time_update_interval);
    time_update_interval = setInterval(function () {
        updateTimerDisplay();
        updateProgressBar();
    }, 1000);
    if (event.data == YT.PlayerState.ENDED) {
        player.playVideoAt(newRandomNumber());
    } else {
        if (firstLoad && event.data == YT.PlayerState.PLAYING) {
            firstLoad = false;
            playlistArray = player.getPlaylist();
            playListArrayLength = playlistArray.length;
            maxNumber = playListArrayLength;
            NewNumber = newRandomNumber();
            player.playVideoAt(newRandomNumber());
            unmute.classList.add("active");
            unmute.classList.remove("hide");
            unmute.onclick = function () {
                player.unMute();
                this.style.display = 'none';
                unmute.classList.remove("active");
                document.getElementById('audio').innerText = 'volume_up';
                document.getElementById('audio').style.color = '#ffffff';
            }
        }
    }
    if (player.getPlayerState() == 1) {
        total = player.getDuration();
        progress_timer = setInterval(function () {
            time = player.getCurrentTime();
            playerTimeDifference = (time / total) * 100;
            progress(playerTimeDifference, $("#videoprogress"));
        }, 1000);
        document.getElementById('resume').onclick = function () {
            player.pauseVideo();
            document.getElementById("play").innerText = "play_arrow";
            animatePlayback();
            playback.classList.add("show");
        };
    } else if (player.getPlayerState() == 2) {
        document.getElementById('resume').onclick = function () {
            player.playVideo();
            document.getElementById("play").innerText = "pause";
            animatePlayback();
            playback.classList.remove("show");
        };
        document.getElementById('playbackstatus').onclick = function () {
            player.playVideo();
            document.getElementById("play").innerText = "pause";
            animatePlayback();
            playback.classList.remove("show");
            this.classList.add('hide');
        };
    } else if (player.getPlayerState() == 5) {
        player.unMute();
        unmute.style.display = 'none';
        unmute.classList.remove("active");
        document.getElementById('audio').innerText = 'volume_up';
        document.getElementById('audio').style.color = '#ffffff';
        playstate.classList.remove("hide");
        document.getElementById("play").innerText = "play_arrow";
        document.getElementById("content").classList.add('d-none');
        document.getElementById('resume').style.background = 'url(img/noise.gif)';
        document.getElementById('resume').onclick = function () {
            player.playVideoAt(newRandomNumber());
            document.getElementById("play").innerText = "pause";
            animatePlayback();
            playback.classList.remove("show");
            document.getElementById("content").classList.remove('d-none');
            document.getElementById('resume').style.background = 'none';
        };
        playstate.onclick = function () {
            player.playVideoAt(newRandomNumber());
            document.getElementById("play").innerText = "pause";
            animatePlayback();
            playback.classList.remove("show");
            this.classList.add('hide');
            document.getElementById("content").classList.remove('d-none');
            document.getElementById('resume').style.background = 'none';
        }
        document.getElementById("play").onclick = function () {
            document.getElementById('resume').style.background = 'none';
        }
    } else {
        clearInterval(progress_timer);
    }
}

function updateTimerDisplay() {
    $('#current').text(formatTime(player.getCurrentTime()));
    $('#duration').text(formatTimeToo(player.getDuration()));
}

function updateProgressBar() {
    $('#seek').val((player.getCurrentTime() / player.getDuration()) * 100);
    $('#progressbar').val((player.getCurrentTime() / player.getDuration()) * 100);
}

$('#seek').on("mouseup touchend", function (e) {
    var newTime = player.getDuration() * (e.target.value / 100);
    player.seekTo(newTime);
});

$('#audio').on('click', function () {
    var mute_toggle = $(this);
    if (player.isMuted()) {
        player.unMute();
        mute_toggle.text("volume_up");
        $('.audio').css({
            color: '#ffffff'
        });
        if (unmute.classList.contains("active")) {
            unmute.style.display = "none";
            unmute.classList.remove("active");
        }
    }
    else {
        player.mute();
        mute_toggle.text('volume_off');
        $('.audio').css({
            color: '#fe0900'
        });
    }
});

var playstate = document.getElementById("playbackstatus");

$('#play').on('click', function () {
    animatePlayback();
    var play_toggle = $(this);
    if (player.getPlayerState() == 1) {
        player.pauseVideo();
        play_toggle.text('play_arrow');
        playstate.classList.remove("hide");
    }
    else {
        player.playVideo();
        play_toggle.text('pause');
        playstate.classList.add("hide");
    }
});

$('#resume').on('click', function () {
    if (player.getPlayerState() == 1) {
        playstate.classList.remove("hide");
    }
    else {
        playstate.classList.add("hide");
    }
});

var elem = document.documentElement;
$('#fullscreen').on('click', function () {
    var fs_toggle = $(this);
    if (document.fullscreenElement) {
        document.exitFullscreen();
        fs_toggle.text('fullscreen');
    } else if (document.webkitFullscreenElement) {
        document.webkitExitFullscreen();
        fs_toggle.text('fullscreen');
    } else if (elem.webkitRequestFullscreen) {
        elem.webkitRequestFullscreen();
        fs_toggle.text('fullscreen_exit');
    } else {
        elem.requestFullscreen();
        fs_toggle.text('fullscreen_exit');
    }
});

$(document).ready(function(){
    autofade();
});

var timer;
var fadeInBuffer = false;
function autofade() {
    $(document).mousemove(function () {
        if (!fadeInBuffer) {
            if (timer) {
                clearTimeout(timer);
                timer = 0;
            }
            $('html').css({
                cursor: ''
            });
        } else {
            fadein();
            fadeInBuffer = false;
        }
        timer = setTimeout(function () {
            fadeout();
            fadeInBuffer = true;
        }, 5000)
    });
    $('body').css({
        cursor: 'default'
    });
}


$('#explore').on('click', function () {
    var carousel = document.getElementById("carousel");
    var vidControls = document.getElementById("video-controls");
    var ticker = document.getElementById("ticker");
    var content = document.getElementById("content");
    var explore = document.getElementById("explore");
    var expand = document.getElementById("expand");
    if (carousel.classList.contains("hide")) {
        carousel.classList.remove("hide");
        vidControls.classList.add("hide");
        ticker.classList.add("hide");
        content.classList.add("-mt");
        explore.classList.add("active");
        expand.innerText = "expand_less";
        $(document).off("mousemove");
        clearTimeout(timer);
    } else {
        carousel.classList.add("hide");
        vidControls.classList.remove("hide");
        ticker.classList.remove("hide");
        content.classList.remove("-mt");
        explore.classList.remove("active");
        expand.innerText = "expand_more";
        autofade();
    }
});

function scrollSmoothTo(elementId) {
    var element = document.getElementById(elementId);
    element.scrollIntoView({ block: 'start', behavior: 'smooth' });
}

function formatTime(time) {
    time = Math.round(time);
    var minutes = Math.floor(time / 60),
        seconds = time - minutes * 60;
    seconds = seconds < 10 ? '0' + seconds : seconds;
    return minutes + ":" + seconds;
}

function formatTimeToo(time) {
    time = Math.round(time);
    var minutes = Math.floor(time / 60),
        seconds = time - minutes * 60;
    seconds = seconds < 10 ? '0' + seconds : seconds;
    if (navigator.userAgent.match(/Mobile/)) {
        return minutes + " M " + seconds + " S";
    }
    else {
        return minutes + " Min " + seconds + " Sec";
    }
}

function progress(percent, $element) {
    var progressBarWidth = (percent * $element.width()) / 100;
    $element.find("#progressbar").animate({ width: progressBarWidth });
}

var playbackIcons = document.querySelectorAll('.playback-icons use');
var playbackAnimation = document.getElementById('playback-animation');

function animatePlayback() {
    playbackIcons.forEach((icon) => icon.classList.toggle('d-none'));
    playbackAnimation.animate(
        [
            {
                opacity: 1,
                transform: 'scale(1)',
            },
            {
                opacity: 0,
                transform: 'scale(1.3)',
            },
        ],
        {
            duration: 500,
        }
    );
}

var text = $('.marquee').text();
    for (var i = 0; i < 5; i++) {
    text += ' ' + text;
}
$('.marquee').html(text);
$('.marquee').marquee({
  duplicated: false,
  startVisible: true,
  speed: 80
});

$(".far-right").click(function(){
    $(".ticker").hide();
});

document.addEventListener('contextmenu', event => event.preventDefault());

(function () {
    function checkTime(i) {
        return (i < 10) ? "0" + i : i;
    }

    function startTime() {
        var today = new Date(),
            h = checkTime(today.getHours()),
            m = checkTime(today.getMinutes()),
            s = checkTime(today.getSeconds());
        document.getElementById('time').innerHTML = h + ":" + m + ":" + s;
        t = setTimeout(function () {
            startTime()
        }, 500);
    }
    startTime();
})();